<!DOCTYPE html>
<html lang="en">
<head>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Algorithm Visualizer</title>
    <style>
        @import url("algorithmstyle.css");
    </style>
  <script>
    document.addEventListener("DOMContentLoaded", () => {
        const inputElement = document.getElementById('customInput');
        const warningMessage = document.getElementById('inputWarningMessage');
        const listSizeInput = document.getElementById('listSize');
        const randomizeButton = document.getElementById('randomize');
        const customInputToggle = document.getElementById('customInputToggle');
        let customUserInput;
        let defaultInput;
        let currentInput; 
        let listSize = Math.floor(Math.random() * 21) + 2;
        createRandomInput(listSize);

        /*
        Creates a randomized list with a length between 2-20 
        and values between 0-99 
        */
        function createRandomInput(size)
        {
            defaultInput = new Array(size);
            for (let i=0; i < size; i++)
            {
                defaultInput[i] = Math.floor(Math.random() * 99);
            }
        }

        /*
        Returns true if all the elements in the given list are whole numbers
        else it returns false
        */
        function isWholeNumbers(list) {
            for (let i = 0; i < list.length; i++) {
                if (list[i] == NaN || !Number.isInteger(list[i])) {
                  return false;
                }
            }
            return true;     
        }
        
        function isWhitespace(str)
        {
            const regex = /^\s*$/;
            return regex.test(str);
        }

        // Prevents the user from typing in their own input in the list size box
        listSizeInput.addEventListener('keydown', function(event) {
            event.preventDefault(); 
          });
        

        listSizeInput.addEventListener('input', function(event){
            listSize = event.target.value; 
            randomizeButton.disabled = false;

        });

        randomizeButton.addEventListener('click', function(event){
            createRandomInput(listSize);
        });

        customInputToggle.addEventListener('change', function() 
        {
            if (this.checked) 
            {    
                if (!inputElement.value)
                {
                    warningMessage.textContent = "Invalid Input: Enter an input";
                    warningMessage.style.color = "red";
                    warningMessage.style.display = "block";
                    customInputToggle.checked = false;
                }
                else
                {
                    let inputList = inputElement.value.trim().split(/\s+/);
                    inputList = inputList.map(Number);
                    if (checkCustomInput(inputList) == true)
                    {
                        console.log(inputList);
                        currentInput = inputList;
                    }
                    else
                    {
                        customInputToggle.checked = false;
                    }
                }
            }
            else
            {
                console.log('false');
                // Set current input equal to the default input
            }
        });

        function checkInputValues(inputList)
        {
            for (let i = 0; i < inputList.length; i++)
            {
                if (inputList[i] > 99 || inputList[i] < -99)
                {
                    return false;
                }
            }
            return true;
        }

        function checkCustomInput(inputList)
        {
            if (inputList == ""){
                warningMessage.textContent = "Invalid Input: Enter an input";
                warningMessage.style.color = "red";
                return false;
            }
            else if (inputList.length > 20 && isWholeNumbers(inputList) == false)
            {
                warningMessage.textContent = "Invalid Input: Only accepts integers and max 20 total values";
                warningMessage.style.color = "red";
                return false;
            }
            else if (inputList.length < 2 && isWholeNumbers(inputList) == false){
                warningMessage.textContent = "Invalid Input: Only accepts integers and a minimum of 2 values";
                warningMessage.style.color = "red";
                return false;
            }
            else if (inputList.length > 20){
                warningMessage.textContent = "Invalid Input: Only accepts a maximum of 20 values";
                warningMessage.style.color = "red";
                return false;
            }
            else if (isWholeNumbers(inputList) == false){
                warningMessage.textContent = "Invalid Input: Only accepts integers";
                warningMessage.style.color = "red";
                return false;
            }
            else if (inputList.length < 2){
                warningMessage.textContent = "Invalid Input: Only accepts a minimum of 2 values";
                warningMessage.style.color = "red";
                return false;
            }
            else{
                if (checkInputValues(inputList) == true){
                    warningMessage.style.color = "#f4f4f4";
                    return true;
                }
                else{
                    warningMessage.textContent = "Invalid Input: Only accepts integers between -99 and 99";
                    warningMessage.style.color = "red";
                    return false;
                }
            }
        }

        const canvas = document.getElementById('algorithmCanvas');

        // Set the canvas width and height to match its parent element's dimensions
        canvas.width = canvas.parentElement.clientWidth;
        canvas.height = canvas.parentElement.clientHeight;

        // Get the 2D rendering context of the canvas
        const ctx = canvas.getContext('2d');

        let data = [50, 150, 100, 200, 80];
        let currentIndex = -1;
        let pivotIndex = -1;
        let swapIndices = [];

        // Initialize a flag to indicate whether sorting is in progress
        let isSorting = false;

        // Function to draw the data as bars on the canvas
        function drawData() 
        {

            // Clear Canvas
            ctx.clearRect(0, 0, canvas.width, canvas.height); 

            const barWidth = canvas.width / data.length;
            const padding = 30;

            // Loop through the data array and draw each bar
            for (let i = 0; i < data.length; i++) {

                // Calculate the height of the bar based on the data value
                const barHeight = data[i];

                // Calculate the x and y coordinates of the bar
                const x = i * barWidth;
                const y = canvas.height - barHeight;

                // Set the fill color of the bar based on its state
                if (swapIndices.includes(i)) {
                    ctx.fillStyle = 'red';
                } else if (i === currentIndex || i === pivotIndex) {
                    ctx.fillStyle = 'blue';
                } else {
                    ctx.fillStyle = 'lightblue';
                }
                
                // Redraw each bar
                ctx.fillRect(x, y, barWidth, barHeight);
                ctx.fillStyle = 'black';
                ctx.font = '14px Arial';
                ctx.textAlign = 'center';
                ctx.fillText(data[i], x + barWidth / 2, canvas.height - 10);
            }     
        }

        async function quickSort(arr, left, right) {

            // If left index is less than right index, continue sorting
            if (left < right) {

                // Get the partition index
                let partitionIndex = await partition(arr, left, right);

                // Recursively sort the left and right subarrays
                await quickSort(arr, left, partitionIndex - 1);
                await quickSort(arr, partitionIndex + 1, right);
            }
        }

        async function partition(arr, left, right) 
        {

            // Chose the rightmost element as the pivot
            let pivot = arr[right];
            pivotIndex = right;

            await delay(1000);

            let i = left - 1;

            // Loop through the array from left to right
            for (let j = left; j < right; j++) {
                currentIndex = j;
                await delay(1000);

                // If the current element is less than the pivot
                if (arr[j] < pivot) {
                    i++;
                    swapIndices = [i, j];
                    [arr[i], arr[j]] = [arr[j], arr[i]];
                    await delay(1000);
                    appendToExplanation(`Swapped ${arr[j]} and ${arr[i]}`);
                }
                swapIndices = [];
            }
            swapIndices = [i + 1, right];
            [arr[i + 1], arr[right]] = [arr[right], arr[i + 1]];
            appendToExplanation(`Swapped ${arr[right]} and ${arr[i+1]}`);
            await delay(1000);
            currentIndex = -1;
            pivotIndex = -1;
            return i + 1;
        }

        // Function to start quicksort
        async function startQuickSort() {
            if (isSorting) return;


            // Draw the bars
            startDrawing();
            
            isSorting = true;

            // Start the quicksort algorithm
            await quickSort(data, 0, data.length - 1);
            appendToExplanation("Sorting complete!");

            // Stop drawing bars
            stopDrawing();

            isSorting = false;
        }

        function startDrawing() {
            drawInterval = setInterval(drawData, 500); 
        }

        function stopDrawing() {
            clearInterval(drawInterval);
        }

        function delay(ms) 
        {
            return new Promise(resolve => setTimeout(resolve, ms));
        }
        function appendToExplanation(text) {
            let box = document.getElementById("textExplanation");
            box.innerHTML += text + "<br>";  
            box.scrollTop = box.scrollHeight;
        }
        
        let drawInterval;
        drawData(); 
        startQuickSort();
});
  </script>
</head>
<body>
    <!-- Top Control Panel -->
    <div class="top-panel">
        <input type="number" max="20" min="2" class="input-box" id="listSize" placeholder="Size" title="Select the size of the randomized list">
        <button class="button" id="randomize" disabled title="Create a randomized list of selected size">Randomize</button>
        <div class="customInputLayout">
            <p id="inputWarningMessage">None</p>
            <input type="text" title="Custom input to give to algorithm" class="input-box" id="customInput" placeholder="Enter 2-20 integers (value -99-99) separated by spaces">
        </div>
        <label id="toggleLayout" class="switch" title="Set or unset the custom input as the default input">
            <input id="customInputToggle" type="checkbox">
            <span class="slider round"></span>
        </label>
        <button class="button" title="Start the animation">&#9658;</button>
        <button class="button" title="Pause the animation">||</button>
        <div class="progress-bar">
            <div class="progress-fill" id="progressFill"></div>
        </div>
        <button class="button" title="Go back 1 frame in the animation">&#9664;</button>
        <button class="button" title="Go forward 1 frame in the animation">&#9654;</button>
    </div>

    <!-- Main Layout -->
    <div class="layout">
        <!-- Left Accordion Menu -->
        <div class="accordion">
            <div class="topnav">
                <input type="text" placeholder="Search...">
                <button type="submit"><i class="fa fa-search"></i></button>
            </div>
            <div class="accordion-item">
                <div class="accordion-header">Brute Force</div>
                <div class="accordion-content">
                    <a href="#" onclick="selectAlgorithm('BFS')">BFS Algorithm</a>
                </div>
            </div>
            <div class="accordion-item">
                <div class="accordion-header">Divide and Conquer</div>
                <div class="accordion-content">
                    <a href="#" onclick="selectAlgorithm('Quicksort')">Quicksort Algorithm</a>
                </div>
            </div>
            <div class="accordion-item">
                <div class="accordion-header">Dynamic Programming</div>
                <div class="accordion-content">
                    <a href="#" onclick="selectAlgorithm('Fibonacci')">Fibonacci Algorithm</a>
                </div>
            </div>
            <div class="accordion-item">
                <div class="accordion-header">Greedy</div>
                <div class="accordion-content">
                    <a href="#" onclick="selectAlgorithm('Dijkstra')">Dijkstra's Algorithm</a>
                </div>
            </div>
        </div>

        <!-- Middle Panels -->
        <div class="middle-panels">
            <div class="panel" id="graphAnimation">
                <canvas id="algorithmCanvas"></canvas>
            </div>
            <div class="panel" id="boxListAnimation">Box-List Animation</div>
            <div class="panel" id="textExplanation"></div>
        </div>
    
        <div class="left-panel">
            <div class="tab">
                <button class="tablinks" onclick="openTab(event, 'description')">Description</button>
                <button class="tablinks" onclick="openTab(event, 'pseudocode')">Pseudocode</button>
                <button class="tablinks" onclick="openTab(event, 'references')">References</button>
            </div>
            <div class="tabcontent" id="description">
                <h3 id="descriptionHeader">Quicksort</h3>
                <p>A divide and conquer sorting algorithm that selects a "pivot"
                    element from the given array and partitions the remaining elements
                    into two sub-arrays based on whether they are smaller or larger than 
                    the pivot. The algorithm recursively repeats this step until the input
                    is sorted.
                    <br>
                    <br>There are mainly three steps in the algorithm:<br>
                    <br>
                    1. <strong>Choose a Pivot</strong>: Select an element from the array as the pivot. The choice of pivot can vary (e.g., first element, last element, random element, or median).<br>
                    <br>
                    2. <strong>Partition the Array</strong>: Rearrange the array around the pivot. After partitioning, all elements smaller than the pivot will be on its left, and all elements greater than the pivot will be on its right. The pivot is then in its correct position, and we obtain the index of the pivot.<br>
                    <br>
                    3. <strong>Recursively Call</strong>: Recursively apply the same process to the two partitioned sub-arrays (left and right of the pivot).<br>
                    <br>
                    4. <strong>Base Case</strong>: The recursion stops when there is only one element left in the sub-array, as a single element is already sorted.<br>
                </p>
            </div>
            <div class="tabcontent" id="references">
                <ol id="referencesList">
                    <li>https://www.geeksforgeeks.org/quick-sort-algorithm/</li>
                    <br>
                    <li>https://www.tutorialspoint.com/data_structures_algorithms/quick_sort_algorithm.htm</li>
                </ol>
            </div>
            <div class="tabcontent" id="pseudocode">
                <pre><code>
                    procedure quickSort(left, right)
                        if right-left <= 0
                            return
                        else     
                            pivot = A[right]
                            partition = partitionFunc(left, right, pivot)
                            quickSort(left,partition-1)
                            quickSort(partition+1,right)    
                        end if		
                    end procedure

                    function partitionFunc(left, right, pivot)
                        leftPointer = left
                        rightPointer = right - 1

                        while True do
                            while A[++leftPointer] < pivot do
                            //do-nothing            
                            end while
                                
                            while rightPointer > 0 && A[--rightPointer] > pivot do
                                //do-nothing         
                            end while
                                
                            if leftPointer >= rightPointer
                                break
                            else                
                                swap leftPointer,rightPointer
                            end if
                        end while 
                                    
                        swap leftPointer,right
                        return leftPointer
                    end function
                </code></pre>
            </div>
        </div>
    <script>
        
        // Set the description tab as the default tab 
        document.addEventListener("DOMContentLoaded", () => {
            // Optional: Set the first tab as active on page load
            document.querySelector(".tablinks").click();
        });
    

        // Accordion Menu Functionality
        document.querySelectorAll('.accordion-header').forEach(header => {
            header.addEventListener('click', () => {
                let content = header.nextElementSibling;
                content.style.display = content.style.display === "block" ? "none" : "block";
            });
        });
        
        function openTab(evt, tabName) {
            // Declare all variables
            var i, tabcontent, tablinks;
        
            // Get all elements with class="tabcontent" and hide them
            tabcontent = document.getElementsByClassName("tabcontent");
            for (i = 0; i < tabcontent.length; i++) {
            tabcontent[i].style.display = "none";
            }
        
            // Get all elements with class="tablinks" and remove the class "active"
            tablinks = document.getElementsByClassName("tablinks");
            for (i = 0; i < tablinks.length; i++) {
            tablinks[i].className = tablinks[i].className.replace(" active", "");
            }
            // Show the current tab, and add an "active" class to the button that opened the tab
            let elementChosen = document.getElementById(tabName);
            document.getElementById(tabName).style.display = "block";
            evt.currentTarget.className += " active";
        }
            
        // Algorithm Selection Function
        function selectAlgorithm(name) {
            document.getElementById("algorithmInfo").innerHTML = `<h3>${name} Algorithm</h3><p>Description and pseudocode here...</p>`;
            document.getElementById("graphAnimation").textContent = `${name} Graph Animation`;
            document.getElementById("boxListAnimation").textContent = `${name} Box-List Animation`;
            document.getElementById("textExplanation").textContent = `${name} explanation here...`;
        }
    </script>

</body>
</html>
